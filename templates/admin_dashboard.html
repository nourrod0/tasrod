<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุญุฉ ุงูุฅุฏุงุฑุฉ - ูุคุณุณุฉ ููุฑ ุงูุชุฌุงุฑูุฉ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .table-hover tbody tr:hover {
            background-color: rgba(0,123,255,0.1);
        }

        .btn-group-sm .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }

        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        .card-stats {
            transition: transform 0.2s;
        }

        .card-stats:hover {
            transform: translateY(-2px);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .table-container {
            max-height: 70vh;
            overflow-y: auto;
        }

        .action-buttons {
            position: sticky;
            top: 0;
            background: white;
            z-index: 100;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .user-name-clickable {
            transition: all 0.2s ease;
            position: relative;
        }

        .user-name-clickable:hover {
            color: #0056b3 !important;
            text-shadow: 0 0 2px rgba(0, 86, 179, 0.3);
            transform: translateX(2px);
        }

        .user-name-clickable:active {
            transform: translateX(1px) scale(0.98);
            color: #003d82 !important;
        }

        .user-name-clickable::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(to right, #007bff, #0056b3);
            transition: width 0.3s ease;
        }

        .user-name-clickable:hover::before {
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- ุดุฑูุท ุนููู ููุฅุฏุงุฑุฉ -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-cog"></i> ููุญุฉ ุงูุฅุฏุงุฑุฉ - ูุคุณุณุฉ ููุฑ ุงูุชุฌุงุฑูุฉ
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    <i class="fas fa-user-shield"></i> {{ session.user_name }}
                </span>
                <a class="nav-link" href="{{ url_for('logout') }}">
                    <i class="fas fa-sign-out-alt"></i> ุฎุฑูุฌ
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-3">
        <div class="row">
            <!-- ูุงุฆูุฉ ุฅุฏุงุฑูุฉ ุฌุงูุจูุฉ -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header bg-danger text-white">
                        <h5><i class="fas fa-tools"></i> ุฅุฏุงุฑุฉ ุงููุธุงู</h5>
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="#" class="list-group-item list-group-item-action active" onclick="showAdminSection('adminMain', this)">
                            <i class="fas fa-chart-bar"></i> ุงูุฅุญุตุงุฆูุงุช
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" onclick="showAdminSection('settings', this)">
                            <i class="fas fa-cog"></i> ุงูุฅุนุฏุงุฏุงุช
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" onclick="showAdminSection('users', this)">
                            <i class="fas fa-users"></i> ุงููุณุชุฎุฏููู
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" onclick="showAdminSection('companies', this)">
                            <i class="fas fa-building"></i> ุดุฑูุงุช ุงูุชุณุฏูุฏ
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" onclick="showAdminSection('customers', this)">
                            <i class="fas fa-address-book"></i> ุงูุฒุจุงุฆู
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" onclick="showAdminSection('inquiryRequests', this)">
                            <i class="fas fa-credit-card"></i> ุทูุจุงุช ุงูุชุณุฏูุฏ
                        </a>
                    </div>
                </div>
            </div>

            <!-- ุงููุญุชูู ุงูุฅุฏุงุฑู -->
            <div class="col-md-9">
                <!-- ุงูุฅุญุตุงุฆูุงุช -->
                <div id="adminMain" class="admin-section active">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="fas fa-chart-bar"></i> ุฅุญุตุงุฆูุงุช ุงููุธุงู</h4>
                        <button class="btn btn-primary btn-sm" onclick="refreshStats()">
                            <i class="fas fa-sync"></i> ุชุญุฏูุซ
                        </button>
                    </div>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="card bg-primary text-white card-stats">
                                <div class="card-body text-center">
                                    <i class="fas fa-users fa-2x mb-2"></i>
                                    <h5>ุงููุณุชุฎุฏููู</h5>
                                    <h3 id="adminUsersCount">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-success text-white card-stats">
                                <div class="card-body text-center">
                                    <i class="fas fa-check-circle fa-2x mb-2"></i>
                                    <h5>ุงูุนูููุงุช ุงููุงุฌุญุฉ</h5>
                                    <h3 id="adminSuccessful">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-warning text-white card-stats">
                                <div class="card-body text-center">
                                    <i class="fas fa-clock fa-2x mb-2"></i>
                                    <h5>ุจุงูุชุธุงุฑ ุงูููุงููุฉ</h5>
                                    <h3 id="adminPending">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-danger text-white card-stats">
                                <div class="card-body text-center">
                                    <i class="fas fa-times-circle fa-2x mb-2"></i>
                                    <h5>ุงูุนูููุงุช ุงููุฑููุถุฉ</h5>
                                    <h3 id="adminRejected">0</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ูุณู ุงูุฅุนุฏุงุฏุงุช -->
                <div id="settings" class="admin-section">
                    <h4><i class="fas fa-cog"></i> ุงูุฅุนุฏุงุฏุงุช</h4>

                    <!-- ุฅุนุฏุงุฏุงุช ุงููููุน -->
                    <div class="card mb-3">
                        <div class="card-header bg-secondary text-white">
                            <h5><i class="fas fa-cogs"></i> ุฅุนุฏุงุฏุงุช ุงููููุน</h5>
                        </div>
                        <div class="card-body">
                            <form id="siteSettingsForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">ุงุณู ุงููููุน</label>
                                            <input type="text" class="form-control" id="siteName" value="ูุคุณุณุฉ ููุฑ ุงูุชุฌุงุฑูุฉ">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">ุญุงูุฉ ุงููููุน</label>
                                            <select class="form-control" id="maintenanceMode">
                                                <option value="false">ูุนูู ุจุดูู ุทุจูุนู</option>
                                                <option value="true">ุชุญุช ุงูุตูุงูุฉ</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">ูุต ุงูุฅุนูุงู</label>
                                    <textarea class="form-control" id="announcement" rows="3">ูุฑุญุจุงู ุจูู ูู ูุธุงู ุชุณุฏูุฏ ููุงุชูุฑ ูุคุณุณุฉ ููุฑ ุงูุชุฌุงุฑูุฉ</textarea>
                                </div>
                                <div class="mb-3" id="maintenanceReasonSection" style="display: none;">
                                    <label class="form-label">ุณุจุจ ุงูุตูุงูุฉ</label>
                                    <textarea class="form-control" id="maintenanceReason" rows="2" placeholder="ุณุจุจ ุฅููุงู ุงููููุน ูุคูุชุงู..."></textarea>
                                </div>
                                <div class="mb-3">
                                    <button type="button" class="btn btn-primary me-2" onclick="saveSiteSettings()">
                                        <i class="fas fa-save"></i> ุญูุธ ุงูุฅุนุฏุงุฏุงุช
                                    </button>
                                    <button type="button" class="btn btn-success me-2" onclick="createBackup()">
                                        <i class="fas fa-download"></i> ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ -->
                    <div class="card">
                        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-archive"></i> ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ</h5>
                            <button type="button" class="btn btn-light btn-sm" onclick="showUploadBackupModal()">
                                <i class="fas fa-upload"></i> ุฑูุน ูุณุฎุฉ ุงุญุชูุงุทูุฉ
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>ุงุณู ุงูููู</th>
                                            <th>ุงูุญุฌู</th>
                                            <th>ุชุงุฑูุฎ ุงูุฅูุดุงุก</th>
                                            <th>ุงูููุดุฆ</th>
                                            <th>ุงูุฅุฌุฑุงุกุงุช</th>
                                        </tr>
                                    </thead>
                                    <tbody id="backupsTableBody">
                                        <tr>
                                            <td colspan="5" class="text-center">ุฌุงุฑู ุงูุชุญููู...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ูุณู ุงููุณุชุฎุฏููู -->
                <div id="users" class="admin-section">
                    <div class="action-buttons">
                        <div class="d-flex justify-content-between align-items-center">
                            <h4><i class="fas fa-users"></i> ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</h4>
                            <button class="btn btn-success" onclick="showAddUserModal()">
                                <i class="fas fa-plus"></i> ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ
                            </button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive table-container">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>ุงูุงุณู</th>
                                            <th>ุฑูู ุงูุฌูุงู</th>
                                            <th>ุงูุฑุตูุฏ</th>
                                            <th>ุงูููุน</th>
                                            <th>ุงูุญุงูุฉ</th>
                                            <th>ุงูุฅุฌุฑุงุกุงุช</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersTableBody">
                                        <tr>
                                            <td colspan="6" class="text-center">ุฌุงุฑู ุงูุชุญููู...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ูุณู ุงูุดุฑูุงุช -->
                <div id="companies" class="admin-section">
                    <div class="action-buttons">
                        <div class="d-flex justify-content-between align-items-center">
                            <h4><i class="fas fa-building"></i> ุดุฑูุงุช ุงูุชุณุฏูุฏ</h4>
                            <div>
                                <button class="btn btn-success me-2" onclick="showAddCompanyModal()">
                                    <i class="fas fa-plus"></i> ุฅุถุงูุฉ ุดุฑูุฉ ุฌุฏูุฏุฉ
                                </button>
                                <button class="btn btn-info" onclick="showCategoriesModal()">
                                    <i class="fas fa-tags"></i> ุฅุฏุงุฑุฉ ุงููุฆุงุช
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive table-container">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>ุงูุดุฑูุฉ</th>
                                            <th>ุงููุฆุฉ</th>
                                            <th>ุงููุณู ุงููุฑุนู</th>
                                            <th>ุงูุนูููุฉ</th>
                                            <th>ุงูุญุงูุฉ</th>
                                            <th>ุงูุฅุฌุฑุงุกุงุช</th>
                                        </tr>
                                    </thead>
                                    <tbody id="companiesTableBody">
                                        <tr>
                                            <td colspan="6" class="text-center">ุฌุงุฑู ุงูุชุญููู...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ูุณู ุงูุฒุจุงุฆู -->
                <div id="customers" class="admin-section">
                    <div class="action-buttons">
                        <div class="d-flex justify-content-between align-items-center">
                            <h4><i class="fas fa-address-book"></i> ุงูุฒุจุงุฆู</h4>
                            <button class="btn btn-success" onclick="showAddCustomerModal()">
                                <i class="fas fa-plus"></i> ุฅุถุงูุฉ ุฒุจูู ุฌุฏูุฏ
                            </button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive table-container">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>ุฑูู ุงููุงุชู</th>
                                            <th>ุงูุงุณู</th>
                                            <th>ุงูุฌูุงู</th>
                                            <th>ุงูุดุฑูุฉ</th>
                                            <th>ููุงุญุธุงุช</th>
                                            <th>ุงูุฅุฌุฑุงุกุงุช</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customersTableBody">
                                        <tr>
                                            <td colspan="6" class="text-center">ุฌุงุฑู ุงูุชุญููู...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ูุณู ุทูุจุงุช ุงูุชุณุฏูุฏ -->
                <div id="inquiryRequests" class="admin-section">
                    <div class="action-buttons">
                        <div class="d-flex justify-content-between align-items-center">
                            <h4><i class="fas fa-credit-card"></i> ุทูุจุงุช ุงูุชุณุฏูุฏ</h4>
                            <button class="btn btn-primary" onclick="refreshPaymentRequests()">
                                <i class="fas fa-sync"></i> ุชุญุฏูุซ
                            </button>
                        </div>
                        <!-- ุฃุฏูุงุช ุงูุจุญุซ ูุงูููุชุฑุฉ -->
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                                    <input type="text" class="form-control" id="paymentRequestsSearch" 
                                           placeholder="ุงูุจุญุซ ูู ุงูุทูุจุงุช...">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <select class="form-control" id="paymentRequestsStatusFilter">
                                    <option value="">ุฌููุน ุงูุญุงูุงุช</option>
                                    <option value="pending">ููุฏ ุงูุงูุชุธุงุฑ</option>
                                    <option value="approved">ููุจูู</option>
                                    <option value="rejected">ูุฑููุถ</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-outline-secondary w-100" onclick="clearSearchFilters()">
                                    <i class="fas fa-times"></i> ูุณุญ
                                </button>
                            </div>
                            <div class="col-md-3">
                                <div class="text-muted small text-center" id="requestsStats">
                                    <i class="fas fa-info-circle"></i> ุงูุฅุญุตุงุฆูุงุช
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive table-container">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th><i class="fas fa-phone"></i> ุฑูู ุงููุงุชู</th>
                                            <th><i class="fas fa-user"></i> ุงุณู ุงูุฒุจูู</th>
                                            <th><i class="fas fa-building"></i> ุงูุดุฑูุฉ</th>
                                            <th><i class="fas fa-money-bill"></i> ุงููุจูุบ</th>
                                            <th><i class="fas fa-info-circle"></i> ุงูุญุงูุฉ</th>
                                            <th><i class="fas fa-calendar"></i> ุงูุชุงุฑูุฎ</th>
                                            <th><i class="fas fa-user-tie"></i> ุงููุณุชุฎุฏู</th>
                                            <th><i class="fas fa-cogs"></i> ุงูุฅุฌุฑุงุกุงุช</th>
                                        </tr>
                                    </thead>
                                    <tbody id="paymentRequestsTableBody">
                                        <tr>
                                            <td colspan="8" class="text-center">ุฌุงุฑู ุงูุชุญููู...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ุฃุณุงุณู ูุชูุงุตูู ุงูุทูุจ -->
    <div class="modal fade" id="requestDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ุชูุงุตูู ุงูุทูุจ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="requestDetailsBody">
                    <!-- ุณูุชู ุชุญููู ุงูุชูุงุตูู ููุง -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅุบูุงู</button>
                    <div id="requestActions">
                        <!-- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช ุณุชุธูุฑ ููุง -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ุฅุถุงูุฉ/ุชุนุฏูู ูุณุชุฎุฏู -->
    <div class="modal fade" id="userModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userModalTitle">ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="userForm">
                        <input type="hidden" id="userId">

                        <!-- ูุนูููุงุช ุฃุณุงุณูุฉ -->
                        <div class="card mb-3">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="fas fa-user"></i> ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-user me-1"></i> ุงูุงุณู *</label>
                                            <input type="text" class="form-control form-control-lg" id="userName" 
                                                   required placeholder="ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู"
                                                   style="border: 2px solid #007bff; border-radius: 8px;">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-phone me-1"></i> ุฑูู ุงูุฌูุงู *</label>
                                            <input type="text" class="form-control form-control-lg" id="userPhone" 
                                                   required placeholder="09XXXXXXXX"
                                                   style="border: 2px solid #007bff; border-radius: 8px;">
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-lock me-1"></i> ูููุฉ ุงููุฑูุฑ</label>
                                    <div class="input-group">
                                        <input type="password" class="form-control form-control-lg" id="userPassword" 
                                               placeholder="ุฃุฏุฎู ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ"
                                               style="border: 2px solid #28a745; border-radius: 8px 0 0 8px;">
                                        <button class="btn btn-outline-success" type="button" 
                                                onclick="togglePasswordVisibility('userPassword', this)"
                                                style="border: 2px solid #28a745; border-left: none; border-radius: 0 8px 8px 0;">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle"></i> 
                                        ุงุชุฑููุง ูุงุฑุบุฉ ูู ุญุงูุฉ ุงูุชุนุฏูู ููุงุญุชูุงุธ ุจูููุฉ ุงููุฑูุฑ ุงูุญุงููุฉ
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- ุฅุนุฏุงุฏุงุช ุงูุญุณุงุจ -->
                        <div class="card mb-3">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0"><i class="fas fa-cog"></i> ุฅุนุฏุงุฏุงุช ุงูุญุณุงุจ</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-wallet me-1 text-warning"></i> ุงูุฑุตูุฏ (ู.ุณ)</label>
                                            <div class="input-group">
                                                <span class="input-group-text bg-warning text-dark">
                                                    <i class="fas fa-coins"></i>
                                                </span>
                                                <input type="number" class="form-control form-control-lg" id="userBalance" 
                                                       value="0" step="0.01" min="0"
                                                       style="border: 2px solid #ffc107; font-weight: bold; font-size: 1.1em;">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-toggle-on me-1 text-info"></i> ุญุงูุฉ ุงูุญุณุงุจ</label>
                                            <select class="form-control form-control-lg" id="userStatus"
                                                    style="border: 2px solid #17a2b8; border-radius: 8px;">
                                                <option value="1">โ ูุดุท ูููุนู</option>
                                                <option value="0">โ ูุนุทู ููุญุฌูุจ</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-user-tag me-1 text-primary"></i> ููุน ุงููุณุชุฎุฏู</label>
                                            <select class="form-control form-control-lg" id="userRole"
                                                    style="border: 2px solid #007bff; border-radius: 8px;">
                                                <option value="user">๐ค ูุณุชุฎุฏู ุนุงุฏู</option>
                                                <option value="admin">๐ ูุฏูุฑ ุงููุธุงู</option>
                                            </select>
                                            <small class="text-muted">
                                                <i class="fas fa-exclamation-triangle text-warning"></i>
                                                ุชุบููุฑ ููุน ุงููุณุชุฎุฏู ุณูุคุซุฑ ุนูู ุตูุงุญูุงุชู ูู ุงููุธุงู
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ูุนูููุงุช ุฅุถุงููุฉ ููุชุนุฏูู -->
                        <div id="editUserInfo" style="display: none;">
                            <div class="card">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0"><i class="fas fa-info-circle"></i> ูุนูููุงุช ุฅุถุงููุฉ</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <small class="text-muted">
                                                <strong>ุชุงุฑูุฎ ุงูุฅูุดุงุก:</strong> <span id="userCreatedAt">-</span>
                                            </small>
                                        </div>
                                        <div class="col-md-6">
                                            <small class="text-muted">
                                                <strong>ูุนุฑู ุงููุณุชุฎุฏู:</strong> <span id="userIdDisplay">-</span>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-outline-secondary me-auto" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> ุฅูุบุงุก
                    </button>
                    <button type="button" class="btn btn-success btn-lg px-4" onclick="saveUser()">
                        <i class="fas fa-save"></i> ุญูุธ ุงูุชุนุฏููุงุช
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ูููุฐุฌ ุฅุถุงูุฉ/ุชุนุฏูู ุดุฑูุฉ -->
    <div class="modal fade" id="companyModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="companyModalTitle">ุฅุถุงูุฉ ุดุฑูุฉ ุฌุฏูุฏุฉ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="companyForm">
                        <input type="hidden" id="companyId">
                        <div class="mb-3">
                            <label class="form-label">ุงุณู ุงูุดุฑูุฉ</label>
                            <input type="text" class="form-control" id="companyName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ุงููุฆุฉ</label>
                            <select class="form-control" id="companyCategory" required>
                                <option value="">ุงุฎุชุฑ ุงููุฆุฉ</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ุงููุณู ุงููุฑุนู</label>
                            <input type="text" class="form-control" id="companySubcategory" placeholder="ูุซุงู: ุฎุฏูุฉ ูููุฒุฉุ ุนุงุฏูุฉุ ุงูุชุตุงุฏูุฉ">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ุงูุนูููุฉ (%)</label>
                            <input type="number" class="form-control" id="companyCommission" value="0" step="0.01" min="0" max="100">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ุงูุญุงูุฉ</label>
                            <select class="form-control" id="companyStatus">
                                <option value="1">ูุดุท</option>
                                <option value="0">ูุนุทู</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                    <button type="button" class="btn btn-primary" onclick="saveCompany()">ุญูุธ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ูููุฐุฌ ุฅุถุงูุฉ/ุชุนุฏูู ุฒุจูู -->
    <div class="modal fade" id="customerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customerModalTitle">ุฅุถุงูุฉ ุฒุจูู ุฌุฏูุฏ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="customerForm">
                        <input type="hidden" id="customerId">
                        <div class="mb-3">
                            <label class="form-label">ุฑูู ุงููุงุชู</label>
                            <input type="text" class="form-control" id="customerPhone" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ุงูุงุณู</label>
                            <input type="text" class="form-control" id="customerName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ุฑูู ุงูุฌูุงู</label>
                            <input type="text" class="form-control" id="customerMobile">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ุงูุดุฑูุฉ</label>
                            <select class="form-control" id="customerCompany">
                                <option value="">ุงุฎุชุฑ ุงูุดุฑูุฉ</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ููุงุญุธุงุช</label>
                            <textarea class="form-control" id="customerNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                    <button type="button" class="btn btn-primary" onclick="saveCustomer()">ุญูุธ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ูููุฐุฌ ุฅุฏุงุฑุฉ ุงููุฆุงุช -->
    <div class="modal fade" id="categoriesModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ุฅุฏุงุฑุฉ ูุฆุงุช ุงูุดุฑูุงุช</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <button class="btn btn-success" onclick="showAddCategoryModal()">
                            <i class="fas fa-plus"></i> ุฅุถุงูุฉ ูุฆุฉ ุฌุฏูุฏุฉ
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ุงูุงุณู</th>
                                    <th>ุงูุฃููููุฉ</th>
                                    <th>ุงูุญุงูุฉ</th>
                                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                                </tr>
                            </thead>
                            <tbody id="categoriesTableBody">
                                <tr>
                                    <td colspan="4" class="text-center">ุฌุงุฑู ุงูุชุญููู...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅุบูุงู</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ูููุฐุฌ ุฅุถุงูุฉ/ุชุนุฏูู ูุฆุฉ -->
    <div class="modal fade" id="categoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="categoryModalTitle">ุฅุถุงูุฉ ูุฆุฉ ุฌุฏูุฏุฉ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="categoryForm">
                        <input type="hidden" id="categoryId">
                        <div class="mb-3">
                            <label class="form-label">ุงุณู ุงููุฆุฉ</label>
                            <input type="text" class="form-control" id="categoryName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ุฃููููุฉ ุงููุฆุฉ</label>
                            <select class="form-control" id="categoryIcon">
                                                               <option value="fas fa-phone">ูุงุชู ุฃุฑุถู - fas fa-phone</option>
                                <option value="fas fa-mobile-alt">ุฌูุงู - fas fa-mobile-alt</option>
                                <option value="fas fa-wifi">ุฅูุชุฑูุช - fas fa-wifi</option>
                                <option value="fas fa-tint">ููุงู - fas fa-tint</option>
                                <option value="fas fa-bolt">ููุฑุจุงุก - fas fa-bolt</option>
                                <option value="fas fa-building">ุนุงู - fas fa-building</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ุงูุญุงูุฉ</label>
                            <select class="form-control" id="categoryStatus">
                                <option value="1">ูุดุท</option>
                                <option value="0">ูุนุทู</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                    <button type="button" class="btn btn-primary" onclick="saveCategory()">ุญูุธ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ูููุฐุฌ ุฅุฏุงุฑุฉ ุงูุฑุตูุฏ -->
    <div class="modal fade" id="balanceModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ุฅุฏุงุฑุฉ ุฑุตูุฏ ุงููุณุชุฎุฏู</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="balanceUserId">
                    <div class="mb-3">
                        <label class="form-label">ุงููุณุชุฎุฏู</label>
                        <p class="form-control-plaintext" id="balanceUserName"></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ุงูุฑุตูุฏ ุงูุญุงูู</label>
                        <p class="form-control-plaintext"><span id="currentBalance">0</span> ู.ุณ</p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ุงููุจูุบ</label>
                        <input type="number" class="form-control" id="balanceAmount" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ููุงุญุธุงุช</label>
                        <textarea class="form-control" id="balanceNotes" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                    <button type="button" class="btn btn-success" onclick="addBalance()">
                        <i class="fas fa-plus"></i> ุฅุถุงูุฉ ุฑุตูุฏ
                    </button>
                    <button type="button" class="btn btn-danger" onclick="deductBalance()">
                        <i class="fas fa-minus"></i> ุฎุตู ุฑุตูุฏ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ูููุฐุฌ ุฅุฑุณุงู ุฅุดุนุงุฑ -->
    <div class="modal fade" id="notificationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ุฅุฑุณุงู ุฅุดุนุงุฑ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="notificationUserId">
                    <div class="mb-3">
                        <label class="form-label">ุงููุณุชุฎุฏู</label>
                        <p class="form-control-plaintext" id="notificationUserName"></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ุนููุงู ุงูุฅุดุนุงุฑ</label>
                        <input type="text" class="form-control" id="notificationTitle" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ูุต ุงูุฅุดุนุงุฑ</label>
                        <textarea class="form-control" id="notificationMessage" rows="4" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                    <button type="button" class="btn btn-primary" onclick="sendNotification()">
                        <i class="fas fa-paper-plane"></i> ุฅุฑุณุงู ุงูุฅุดุนุงุฑ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ูููุฐุฌ ุฑูุน ูุณุฎุฉ ุงุญุชูุงุทูุฉ -->
    <div class="modal fade" id="uploadBackupModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ุฑูุน ูุณุฎุฉ ุงุญุชูุงุทูุฉ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <strong>ุชูุจูู:</strong> ูุฑุฌู ุงูุชุฃูุฏ ูู ุฃู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุงููุฑููุนุฉ ุตุญูุญุฉ ูุชุญุชูู ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.
                    </div>
                    <form id="uploadBackupForm" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label class="form-label">ุงุฎุชุฑ ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ</label>
                            <input type="file" class="form-control" id="backupFileInput" name="backup_file" accept=".zip" required>
                            <small class="text-muted">ูุฌุจ ุฃู ูููู ุงูููู ุจุตูุบุฉ ZIP</small>
                        </div>
                        <div class="mb-3" id="uploadProgress" style="display: none;">
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%">
                                    ุฌุงุฑู ุงูุฑูุน...
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                    <button type="button" class="btn btn-success" onclick="uploadBackup()">
                        <i class="fas fa-upload"></i> ุฑูุน ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ูููุฐุฌ ุชุฃููุฏ ุงูุงุณุชุนุงุฏุฉ -->
    <div class="modal fade" id="restoreConfirmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">ุชุฃููุฏ ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>ุชุญุฐูุฑ:</strong> ุณูุชู ุงุณุชุจุฏุงู ุฌููุน ุงูุจูุงูุงุช ุงูุญุงููุฉ ุจุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุงููุฎุชุงุฑุฉ.
                    </div>
                    <p>ูู ุฃูุช ูุชุฃูุฏ ูู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ: <strong id="restoreFilename"></strong>ุ</p>
                    <p><small class="text-muted">ุณูุชู ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุงูุจูุงูุงุช ุงูุญุงููุฉ ูุจู ุงูุงุณุชุนุงุฏุฉ.</small></p>
                    <input type="hidden" id="restoreBackupFilename">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                    <button type="button" class="btn btn-danger" onclick="confirmRestore()">
                        <i class="fas fa-undo"></i> ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ูููุฐุฌ ุชูุงุตูู ุงูุฒุจูู -->
    <div class="modal fade" id="customerDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-user"></i> ุชูุงุตูู ุงูุฒุจูู
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0"><i class="fas fa-address-card"></i> ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <strong><i class="fas fa-user me-2 text-primary"></i>ุงูุงุณู:</strong>
                                        <span id="customerDetailName" class="ms-2"></span>
                                    </div>
                                    <div class="mb-3">
                                        <strong><i class="fas fa-phone me-2 text-success"></i>ุฑูู ุงููุงุชู:</strong>
                                        <span id="customerDetailPhone" class="ms-2"></span>
                                    </div>
                                    <div class="mb-3">
                                        <strong><i class="fas fa-mobile-alt me-2 text-info"></i>ุฑูู ุงูุฌูุงู:</strong>
                                        <span id="customerDetailMobile" class="ms-2"></span>
                                    </div>
                                    <div class="mb-3">
                                        <strong><i class="fas fa-building me-2 text-warning"></i>ุงูุดุฑูุฉ:</strong>
                                        <span id="customerDetailCompany" class="ms-2"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header bg-secondary text-white">
                                    <h6 class="mb-0"><i class="fas fa-info-circle"></i> ูุนูููุงุช ุฅุถุงููุฉ</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <strong><i class="fas fa-user-plus me-2 text-success"></i>ุฃุถุงูู:</strong>
                                        <span id="customerDetailAddedBy" class="ms-2"></span>
                                    </div>
                                    <div class="mb-3">
                                        <strong><i class="fas fa-calendar-plus me-2 text-info"></i>ุชุงุฑูุฎ ุงูุฅุถุงูุฉ:</strong>
                                        <span id="customerDetailCreatedAt" class="ms-2"></span>
                                    </div>
                                    <div class="mb-3">
                                        <strong><i class="fas fa-user-edit me-2 text-warning"></i>ุขุฎุฑ ุชุนุฏูู ุจูุงุณุทุฉ:</strong>
                                        <span id="customerDetailUpdatedBy" class="ms-2"></span>
                                    </div>
                                    <div class="mb-3">
                                        <strong><i class="fas fa-calendar-edit me-2 text-danger"></i>ุชุงุฑูุฎ ุขุฎุฑ ุชุนุฏูู:</strong>
                                        <span id="customerDetailUpdatedAt" class="ms-2"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3" id="customerNotesSection" style="display: none;">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0"><i class="fas fa-sticky-note me-2 text-info"></i>ุงูููุงุญุธุงุช</h6>
                                </div>
                                <div class="card-body">
                                    <p id="customerDetailNotes" class="mb-0"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="editCustomerFromDetails()">
                        <i class="fas fa-edit"></i> ุชุนุฏูู ุงูุจูุงูุงุช
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> ุฅุบูุงู
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ุชุญููู ุงูููุชุจุงุช -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>

    <script>
        // ูุชุบูุฑุงุช ุนุงูุฉ ููุตูุญุฉ ุงูุฅุฏุงุฑูุฉ
        let adminCurrentRequestId = null;
        let adminPaymentRequests = [];
        let adminIsLoading = false;

        // ุชููุฆุฉ ุงูุชุทุจูู
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ุชุญููู ููุญุฉ ุงูุฅุฏุงุฑุฉ...');
            initializeAdminDashboard();
        });

        // ุชููุฆุฉ ููุญุฉ ุงูุฅุฏุงุฑุฉ
        function initializeAdminDashboard() {
            try {
                // ุชุญููู ุงูุฅุญุตุงุฆูุงุช ุงูุฃุณุงุณูุฉ
                refreshStats();

                // ุฅุนุฏุงุฏ ูุณุชูุนู ุงูุฃุญุฏุงุซ
                setupEventListeners();

                console.log('ุชู ุชููุฆุฉ ููุญุฉ ุงูุฅุฏุงุฑุฉ ุจูุฌุงุญ');
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชููุฆุฉ ููุญุฉ ุงูุฅุฏุงุฑุฉ:', error);
                showMessage('ุฎุทุฃ ูู ุชููุฆุฉ ููุญุฉ ุงูุฅุฏุงุฑุฉ', 'error');
            }
        }

        // ุฅุนุฏุงุฏ ูุณุชูุนู ุงูุฃุญุฏุงุซ
        function setupEventListeners() {
            // ุงูุจุญุซ ูู ุทูุจุงุช ุงูุชุณุฏูุฏ
            const searchInput = document.getElementById('paymentRequestsSearch');
            const statusFilter = document.getElementById('paymentRequestsStatusFilter');

            if (searchInput) {
                searchInput.addEventListener('input', debounce(searchPaymentRequests, 500));
            }

            if (statusFilter) {
                statusFilter.addEventListener('change', searchPaymentRequests);
            }

            // ูุฑุงูุจุฉ ุชุบููุฑ ูุถุน ุงูุตูุงูุฉ
            const maintenanceMode = document.getElementById('maintenanceMode');
            if (maintenanceMode) {
                maintenanceMode.addEventListener('change', function() {
                    const reasonSection = document.getElementById('maintenanceReasonSection');
                    if (reasonSection) {
                        reasonSection.style.display = this.value === 'true' ? 'block' : 'none';
                    }
                });
            }
        }

        // ุฏุงูุฉ ุชุฃุฎูุฑ ุงูุจุญุซ
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ุฅุธูุงุฑ ุงูุฃูุณุงู ุงูุฅุฏุงุฑูุฉ
        function showAdminSection(sectionId, clickedElement) {
            try {
                console.log('ุฅุธูุงุฑ ุงููุณู:', sectionId);

                // ุชุญุฏูุซ ุงููุงุฆูุฉ ุงููุดุทุฉ
                document.querySelectorAll('.list-group-item').forEach(item => {
                    item.classList.remove('active');
                });
                if (clickedElement) {
                    clickedElement.classList.add('active');
                }

                // ุฅุฎูุงุก ุฌููุน ุงูุฃูุณุงู
                document.querySelectorAll('.admin-section').forEach(section => {
                    section.classList.remove('active');
                });

                // ุฅุธูุงุฑ ุงููุณู ุงููุทููุจ
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.add('active');
                    loadSectionData(sectionId);
                } else {
                    throw new Error(`ุงููุณู ${sectionId} ุบูุฑ ููุฌูุฏ`);
                }

            } catch (error) {
                console.error(`ุฎุทุฃ ูู ุฅุธูุงุฑ ุงููุณู ${sectionId}:`, error);
                showMessage(`ุฎุทุฃ ูู ุฅุธูุงุฑ ุงููุณู ุงููุทููุจ: ${error.message}`, 'error');
            }
        }

        // ุชุญููู ุจูุงูุงุช ุงููุณู
        async function loadSectionData(sectionId) {
            if (adminIsLoading) return;

            try {
                adminIsLoading = true;

                switch (sectionId) {
                    case 'adminMain':
                        await refreshStats();
                        break;
                    case 'users':
                        await loadUsers();
                        break;
                    case 'companies':
                        await loadCompaniesAdmin();
                        break;
                    case 'customers':
                        await loadCustomers();
                        break;
                    case 'inquiryRequests':
                        await loadPaymentRequests();
                        break;
                    case 'settings':
                        await loadSiteSettingsAdmin();
                        await loadBackups();
                        break;
                }
            } catch (error) {
                console.error(`ุฎุทุฃ ูู ุชุญููู ุจูุงูุงุช ุงููุณู ${sectionId}:`, error);
                showMessage(`ุฎุทุฃ ูู ุชุญููู ุจูุงูุงุช ุงููุณู: ${error.message}`, 'error');
            } finally {
                adminIsLoading = false;
            }
        }

        // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
        async function refreshStats() {
            try {
                const response = await fetch('/api/admin-stats');
                if (response.ok) {
                    const stats = await response.json();
                    updateStatsDisplay(stats);
                } else {
                    throw new Error(`ุฎุทุฃ ูู ุงูุฎุงุฏู: ${response.status}`);
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุงูุฅุญุตุงุฆูุงุช:', error);
                // ุนุฑุถ ููู ุงูุชุฑุงุถูุฉ ูู ุญุงูุฉ ุงูุฎุทุฃ
                updateStatsDisplay({
                    users_count: 0,
                    successful: 0,
                    pending: 0,
                    rejected: 0
                });
            }
        }

        // ุชุญุฏูุซ ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช
        function updateStatsDisplay(stats) {
            const elements = {
                usersCount: document.getElementById('adminUsersCount'),
                successful: document.getElementById('adminSuccessful'),
                pending: document.getElementById('adminPending'),
                rejected: document.getElementById('adminRejected')
            };

            Object.keys(elements).forEach(key => {
                if (elements[key]) {
                    const value = stats[key.replace('Count', '_count')] || stats[key] || 0;
                    elements[key].textContent = value;
                }
            });
        }

        // ุชุญููู ุงููุณุชุฎุฏููู
        async function loadUsers() {
            const tableBody = document.getElementById('usersTableBody');
            showTableLoading(tableBody, 6, 'ุฌุงุฑู ุชุญููู ุงููุณุชุฎุฏููู...');

            try {
                const response = await fetch('/api/users');
                if (response.ok) {
                    const users = await response.json();
                    displayUsers(users);
                } else {
                    throw new Error(`ุฎุทุฃ ูู ุงูุฎุงุฏู: ${response.status}`);
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุงููุณุชุฎุฏููู:', error);
                showTableError(tableBody, 6, error.message, 'loadUsers()');
            }
        }

        // ุนุฑุถ ุงููุณุชุฎุฏููู
        function displayUsers(users) {
            const tableBody = document.getElementById('usersTableBody');
            if (!tableBody) return;

            if (!users || users.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">ูุง ุชูุฌุฏ ูุณุชุฎุฏููู</td></tr>';
                return;
            }

            let html = '';
            users.forEach(user => {
                const statusBadge = user.is_active ? 
                    '<span class="badge bg-success">ูุดุท</span>' : 
                    '<span class="badge bg-danger">ูุนุทู</span>';
                const roleBadge = user.role === 'admin' ? 
                    '<span class="badge bg-primary">ูุฏูุฑ</span>' : 
                    '<span class="badge bg-secondary">ูุณุชุฎุฏู</span>';

                // ุชูุธูู ุงุณู ุงููุณุชุฎุฏู ูุชุฌูุจ ูุดุงูู ูู JavaScript
                const safeName = user.name.replace(/'/g, "\\'").replace(/"/g, '\\"');

                html += `
                    <tr>
                        <td>
                            <span class="text-primary fw-bold user-name-clickable" 
                                  onclick="editUser(${user.id}); event.stopPropagation();" 
                                  style="cursor: pointer; text-decoration: underline; transition: all 0.2s ease;"
                                  title="ุงุถุบุท ูุชุนุฏูู ุงูุจูุงูุงุช"
                                  onmouseover="this.style.color='#0056b3'; this.style.textShadow='0 0 2px rgba(0,86,179,0.3)';"
                                  onmouseout="this.style.color=''; this.style.textShadow='';">
                                <i class="fas fa-user me-2"></i>
                                ${user.name}
                            </span>
                        </td>
                        <td>${user.phone}</td>
                        <td>${user.balance} ู.ุณ</td>
                        <td>${roleBadge}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="editUser(${user.id})" title="ุชุนุฏูู">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-success" onclick="manageUserBalance(${user.id}, '${safeName}', ${user.balance})" title="ุฅุฏุงุฑุฉ ุงูุฑุตูุฏ">
                                    <i class="fas fa-wallet"></i>
                                </button>
                                <button class="btn btn-outline-info" onclick="sendUserNotification(${user.id}, '${safeName}')" title="ุฅุฑุณุงู ุฅุดุนุงุฑ">
                                    <i class="fas fa-bell"></i>
                                </button>
                                ${user.role !== 'admin' ? `
                                    <button class="btn btn-outline-danger" onclick="deleteUser(${user.id})" title="ุญุฐู">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = html;
        }

        // ุชุญููู ุทูุจุงุช ุงูุชุณุฏูุฏ
        async function loadPaymentRequests() {
            const tableBody = document.getElementById('paymentRequestsTableBody');
            showTableLoading(tableBody, 8, 'ุฌุงุฑู ุชุญููู ุทูุจุงุช ุงูุชุณุฏูุฏ...');

            try {
                const response = await fetch('/api/payment-requests');
                if (response.ok) {
                    adminPaymentRequests = await response.json();
                    displayPaymentRequests(adminPaymentRequests);
                    updateRequestsStatistics();
                } else {
                    throw new Error(`ุฎุทุฃ ูู ุงูุฎุงุฏู: ${response.status}`);
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุทูุจุงุช ุงูุชุณุฏูุฏ:', error);
                showTableError(tableBody, 8, error.message, 'loadPaymentRequests()');
            }
        }

        // ุชุญุฏูุซ ุทูุจุงุช ุงูุชุณุฏูุฏ
        function refreshPaymentRequests() {
            loadPaymentRequests();
        }

        // ุนุฑุถ ุทูุจุงุช ุงูุชุณุฏูุฏ
        function displayPaymentRequests(requests) {
            const tableBody = document.getElementById('paymentRequestsTableBody');
            if (!tableBody) return;

            // ุชุทุจูู ุงูููุชุฑ ูุงูุจุญุซ
            const searchTerm = document.getElementById('paymentRequestsSearch')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('paymentRequestsStatusFilter')?.value || '';

            let filteredRequests = requests;
            if (searchTerm || statusFilter) {
                filteredRequests = requests.filter(request => {
                    const matchesSearch = !searchTerm || 
                        (request.phone_number && request.phone_number.toLowerCase().includes(searchTerm)) ||
                        (request.customer_name && request.customer_name.toLowerCase().includes(searchTerm)) ||
                        (request.company_name && request.company_name.toLowerCase().includes(searchTerm));

                    const matchesStatus = !statusFilter || request.status === statusFilter;

                    return matchesSearch && matchesStatus;
                });
            }

            if (!filteredRequests || filteredRequests.length === 0) {
                const message = searchTerm || statusFilter ? 'ูุง ุชูุฌุฏ ูุชุงุฆุฌ ุชุทุงุจู ุงูุจุญุซ' : 'ูุง ุชูุฌุฏ ุทูุจุงุช ุชุณุฏูุฏ';
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center">
                            <div class="alert alert-info d-inline-block">
                                <i class="fas fa-info-circle"></i> ${message}
                                ${(searchTerm || statusFilter) ? `
                                    <br>
                                    <button class="btn btn-sm btn-outline-info mt-2" onclick="clearSearchFilters()">
                                        <i class="fas fa-times"></i> ูุณุญ ุงูููุงุชุฑ
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            let html = '';
            filteredRequests.forEach((request) => {
                const statusBadge = `<span class="badge bg-${getStatusBadgeClass(request.status)}">${getStatusText(request.status)}</span>`;
                const rowClass = request.status === 'pending' ? 'table-warning' : '';

                html += `
                    <tr class="request-row ${rowClass}" style="cursor: pointer;" onclick="showRequestDetails(${request.id})">
                        <td>${request.phone_number || 'ุบูุฑ ูุญุฏุฏ'}</td>
                        <td>${request.customer_name || 'ุบูุฑ ูุญุฏุฏ'}</td>
                        <td>${request.company_name || 'ุบูุฑ ูุญุฏุฏ'}</td>
                        <td>
                            ${request.amount ? `${request.amount} ู.ุณ` : '<span class="text-warning">ุบูุฑ ูุญุฏุฏ</span>'}
                        </td>
                        <td>${statusBadge}</td>
                        <td>${formatDate(request.created_at)}</td>
                        <td>${request.user_name || 'ุบูุฑ ูุญุฏุฏ'}</td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                ${request.status === 'pending' ? `
                                    <button type="button" class="btn btn-success btn-sm" 
                                            onclick="event.stopPropagation(); handleRequestAction(${request.id}, 'approve')" 
                                            title="ููุงููุฉ">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button type="button" class="btn btn-danger btn-sm" 
                                            onclick="event.stopPropagation(); handleRequestAction(${request.id}, 'reject')" 
                                            title="ุฑูุถ">
                                        <i class="fas fa-times"></i>
                                    </button>
                                ` : ''}
                                <button type="button" class="btn btn-info btn-sm" 
                                        onclick="event.stopPropagation(); showRequestDetails(${request.id})" 
                                        title="ุงูุชูุงุตูู">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = html;
        }

        // ุฅุธูุงุฑ ุชูุงุตูู ุงูุทูุจ
        async function showRequestDetails(requestId) {
            try {
                adminCurrentRequestId = requestId;
                showLoadingOverlay('ุฌุงุฑู ุชุญููู ุชูุงุตูู ุงูุทูุจ...');

                const response = await fetch(`/api/payment-requests/${requestId}`);
                if (response.ok) {
                    const request = await response.json();
                    displayRequestDetailsModal(request);
                } else if (response.status === 404) {
                    showMessage('ุงูุทูุจ ุบูุฑ ููุฌูุฏ', 'error');
                } else {
                    throw new Error(`ุฎุทุฃ ูู ุงูุฎุงุฏู: ${response.status}`);
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุชูุงุตูู ุงูุทูุจ:', error);
                showMessage('ุฎุทุฃ ูู ุชุญููู ุชูุงุตูู ุงูุทูุจ', 'error');
            } finally {
                hideLoadingOverlay();
            }
        }

        // ุนุฑุถ ุชูุงุตูู ุงูุทูุจ ูู ููุฏุงู
        function displayRequestDetailsModal(request) {
            const modalBody = document.getElementById('requestDetailsBody');
            const actionsContainer = document.getElementById('requestActions');

            if (!modalBody) return;

            const statusText = getStatusText(request.status);
            const statusClass = getStatusBadgeClass(request.status);

            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6>ูุนูููุงุช ุงูุฒุจูู:</h6>
                        <p><strong>ุงูุงุณู:</strong> ${request.customer_name || '-'}</p>
                        <p><strong>ุฑูู ุงููุงุชู:</strong> ${request.phone_number || '-'}</p>
                        <p><strong>ุฑูู ุงูุฌูุงู:</strong> ${request.mobile_number || '-'}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>ูุนูููุงุช ุงูุฎุฏูุฉ:</h6>
                        <p><strong>ุงูุดุฑูุฉ:</strong> ${request.company_name || '-'}</p>
                        <p><strong>ุงููุฆุฉ:</strong> ${request.category_name || '-'}</p>
                        <p><strong>ุงููุจูุบ:</strong> ${request.amount || 0} ู.ุณ</p>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <p><strong>ุงูุญุงูุฉ:</strong> <span class="badge bg-${statusClass}">${statusText}</span></p>
                        <p><strong>ุชุงุฑูุฎ ุงูุฅูุดุงุก:</strong> ${formatDate(request.created_at)}</p>
                        ${request.approved_at ? `<p><strong>ุชุงุฑูุฎ ุงููุนุงูุฌุฉ:</strong> ${formatDate(request.approved_at)}</p>` : ''}
                    </div>
                    <div class="col-md-6">
                        <p><strong>ุงููุณุชุฎุฏู:</strong> ${request.user_name || '-'}</p>
                        ${request.notes ? `<p><strong>ููุงุญุธุงุช:</strong> ${request.notes}</p>` : ''}
                        ${request.staff_notes ? `<p><strong>ููุงุญุธุฉ ุงูููุธู:</strong> ${request.staff_notes}</p>` : ''}
                    </div>
                </div>
            `;

            // ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช
            if (actionsContainer) {
                let actionsHtml = '';
                if (request.status === 'pending') {
                    actionsHtml = `
                        <button type="button" class="btn btn-success me-2" onclick="handleRequestAction(${request.id}, 'approve')">
                            <i class="fas fa-check"></i> ููุงููุฉ
                        </button>
                        <button type="button" class="btn btn-danger" onclick="handleRequestAction(${request.id}, 'reject')">
                            <i class="fas fa-times"></i> ุฑูุถ
                        </button>
                    `;
                }
                actionsContainer.innerHTML = actionsHtml;
            }

            const modal = new bootstrap.Modal(document.getElementById('requestDetailsModal'));
            modal.show();
        }

        // ูุนุงูุฌุฉ ุฅุฌุฑุงุกุงุช ุงูุทูุจ
        async function handleRequestAction(requestId, action) {
            if (!requestId || !action) return;

            try {
                let url, method, body, confirmMessage;

                if (action === 'approve') {
                    url = `/api/payment-requests/${requestId}/approve`;
                    method = 'POST';
                    confirmMessage = 'ูู ุฃูุช ูุชุฃูุฏ ูู ุงูููุงููุฉ ุนูู ูุฐุง ุงูุทูุจุ';
                } else if (action === 'reject') {
                    const reason = prompt('ูุฑุฌู ุฅุฏุฎุงู ุณุจุจ ุงูุฑูุถ:', 'ูู ูุชู ุงุณุชููุงุก ุงูุดุฑูุท ุงููุทููุจุฉ');
                    if (reason === null) return;

                    url = `/api/payment-requests/${requestId}/reject`;
                    method = 'POST';
                    body = JSON.stringify({ reason: reason || 'ุบูุฑ ูุญุฏุฏ' });
                    confirmMessage = 'ูู ุฃูุช ูุชุฃูุฏ ูู ุฑูุถ ูุฐุง ุงูุทูุจุ';
                }

                if (!confirm(confirmMessage)) return;

                showLoadingOverlay('ุฌุงุฑู ูุนุงูุฌุฉ ุงูุทูุจ...');

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: body
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(result.message || 'ุชู ูุนุงูุฌุฉ ุงูุทูุจ ุจูุฌุงุญ', 'success');

                    // ุฅุบูุงู ุงูููุฏุงู
                    const detailsModal = bootstrap.Modal.getInstance(document.getElementById('requestDetailsModal'));
                    if (detailsModal) {
                        detailsModal.hide();
                    }

                    // ุฅุนุงุฏุฉ ุชุญููู ุงูุจูุงูุงุช
                    await loadPaymentRequests();
                    await refreshStats();
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ูุนุงูุฌุฉ ุงูุทูุจ', 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ูุนุงูุฌุฉ ุงูุทูุจ:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            } finally {
                hideLoadingOverlay();
            }
        }

        // ุงูุจุญุซ ูู ุทูุจุงุช ุงูุชุณุฏูุฏ
        function searchPaymentRequests() {
            if (adminPaymentRequests.length > 0) {
                displayPaymentRequests(adminPaymentRequests);
            }
        }

        // ูุณุญ ููุงุชุฑ ุงูุจุญุซ
        function clearSearchFilters() {
            const searchInput = document.getElementById('paymentRequestsSearch');
            const statusFilter = document.getElementById('paymentRequestsStatusFilter');

            if (searchInput) searchInput.value = '';
            if (statusFilter) statusFilter.value = '';

            if (adminPaymentRequests.length > 0) {
                displayPaymentRequests(adminPaymentRequests);
            }
        }

        // ===== ุฏูุงู ูุณุงุนุฏุฉ =====
        // ุชุนุฏูู ุฅุญุตุงุฆูุงุช ุงููุนุงููุงุช
        function updateRequestsStatistics() {
            const statsElement = document.getElementById('requestsStats');
            if (statsElement && adminPaymentRequests.length > 0) {
                const pending = adminPaymentRequests.filter(r => r.status === 'pending').length;
                const approved = adminPaymentRequests.filter(r => r.status === 'approved').length;
                const rejected = adminPaymentRequests.filter(r => r.status === 'rejected').length;

                statsElement.innerHTML = `
                    <small class="text-muted">
                        <i class="fas fa-clock text-warning"></i> ููุฏ ุงูุงูุชุธุงุฑ: ${pending} |
                        <i class="fas fa-check text-success"></i> ููุจูู: ${approved} |
                        <i class="fas fa-times text-danger"></i> ูุฑููุถ: ${rejected}
                    </small>
                `;
            }
        }

        // ุฏูุงู ูุณุงุนุฏุฉ
        function showTableLoading(tableBody, colspan, message) {
            if (tableBody) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="${colspan}" class="text-center">
                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                <span class="visually-hidden">ุฌุงุฑู ุงูุชุญููู...</span>
                            </div>
                            <div class="mt-2">${message}</div>
                        </td>
                    </tr>
                `;
            }
        }

        function showTableError(tableBody, colspan, message, retryFunction) {
            if (tableBody) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="${colspan}" class="text-center">
                            <div class="alert alert-danger d-inline-block">
                                <i class="fas fa-exclamation-triangle"></i> ${message}
                                <br>
                                <button class="btn btn-sm btn-outline-danger mt-2" onclick="${retryFunction}">
                                    <i class="fas fa-redo"></i> ุฅุนุงุฏุฉ ุงููุญุงููุฉ
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }
        }

        function showLoadingOverlay(message = 'ุฌุงุฑู ุงูุชุญููู...') {
            let overlay = document.getElementById('loadingOverlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'loadingOverlay';
                overlay.className = 'loading-overlay';
                overlay.innerHTML = `
                    <div class="text-center text-white">
                        <div class="spinner-border mb-3" role="status">
                            <span class="visually-hidden">ุฌุงุฑู ุงูุชุญููู...</span>
                        </div>
                        <div>${message}</div>
                    </div>
                `;
                document.body.appendChild(overlay);
            } else {
                overlay.style.display = 'flex';
                overlay.querySelector('div:last-child').textContent = message;
            }
        }

        function hideLoadingOverlay() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        function showMessage(message, type = 'info') {
            const alertClass = {
                'success': 'alert-success',
                'error': 'alert-danger',
                'warning': 'alert-warning',
                'info': 'alert-info'
            }[type] || 'alert-info';

            const iconClass = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-triangle',
                'warning': 'fas fa-exclamation-circle',
                'info': 'fas fa-info-circle'
            }[type] || 'fas fa-info-circle';

            // ุฅุฒุงูุฉ ุงูุฑุณุงุฆู ุงูููุฌูุฏุฉ
            document.querySelectorAll('.custom-alert').forEach(alert => alert.remove());

            // ุฅูุดุงุก ุงูุฑุณุงูุฉ ุงูุฌุฏูุฏุฉ
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClass} alert-dismissible fade show position-fixed custom-alert`;
            alertDiv.style.cssText = 'top: 80px; right: 20px; z-index: 9999; max-width: 400px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);';
            alertDiv.innerHTML = `
                <i class="${iconClass} me-2"></i>${message}
                <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
            `;

            document.body.appendChild(alertDiv);

            // ุฅุฒุงูุฉ ุชููุงุฆูุฉ ุจุนุฏ 5 ุซูุงู
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 5000);
        }

        function getStatusBadgeClass(status) {
            const classes = {
                'pending': 'warning',
                'approved': 'success',
                'rejected': 'danger'
            };
            return classes[status] || 'secondary';
        }

        function getStatusText(status) {
            const texts = {
                'pending': 'ููุฏ ุงูุงูุชุธุงุฑ',
                'approved': 'ููุจูู',
                'rejected': 'ูุฑููุถ'
            };
            return texts[status] || status;
        }

        function formatDate(dateString) {
            if (!dateString) return '';

            // ุฅูุดุงุก ูุงุฆู ุงูุชุงุฑูุฎ
            const date = new Date(dateString);

            // ุฅุถุงูุฉ 3 ุณุงุนุงุช ูุชุตุญูุญ ุงูุชูููุช
            date.setHours(date.getHours() + 3);

            // ุชูุณูู ุงูุชุงุฑูุฎ ุจุงูุตูุบุฉ ุงููููุงุฏูุฉ ุงูุนุฑุจูุฉ
            return date.toLocaleString('ar-EG', {
                calendar: 'gregory', // ุงูุชูููู ุงููููุงุฏู
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false,
                timeZone: 'Asia/Damascus' // ุชูููุช ุฏูุดู
            });
        }

        // ุชุญููู ุงูุดุฑูุงุช ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
        async function loadCompaniesAdmin() {
            const tableBody = document.getElementById('companiesTableBody');
            showTableLoading(tableBody, 6, 'ุฌุงุฑู ุชุญููู ุงูุดุฑูุงุช...');

            try {
                const response = await fetch('/api/companies');
                if (response.ok) {
                    const companies = await response.json();
                    console.log('ุชู ุชุญููู ุงูุดุฑูุงุช:', companies.length);
                    displayCompaniesAdmin(companies);
                } else {
                    throw new Error(`ุฎุทุฃ ูู ุงูุฎุงุฏู: ${response.status}`);
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุงูุดุฑูุงุช:', error);
                showTableError(tableBody, 6, error.message, 'loadCompaniesAdmin()');
            }
        }

        // ุนุฑุถ ุงูุดุฑูุงุช ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
        function displayCompaniesAdmin(companies) {
            const tableBody = document.getElementById('companiesTableBody');
            if (!tableBody) return;

            if (!companies || companies.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">ูุง ุชูุฌุฏ ุดุฑูุงุช</td></tr>';
                return;
            }

            let html = '';
            companies.forEach(company => {
                const statusBadge = company.is_active ? 
                    '<span class="badge bg-success">ูุดุท</span>' : 
                    '<span class="badge bg-danger">ูุนุทู</span>';

                html += `
                    <tr>
                        <td>
                            <i class="${company.category_icon || 'fas fa-building'}"></i>
                            ${company.name}
                        </td>
                        <td>${company.category_name || 'ุบูุฑ ูุญุฏุฏ'}</td>
                        <td>${company.subcategory || '-'}</td>
                        <td>${company.commission}%</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="editCompany(${company.id})" title="ุชุนุฏูู">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteCompany(${company.id})" title="ุญุฐู">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = html;
        }

        // ุชุญููู ุงูุฒุจุงุฆู
        async function loadCustomers() {
            const tableBody = document.getElementById('customersTableBody');
            showTableLoading(tableBody, 6, 'ุฌุงุฑู ุชุญููู ุงูุฒุจุงุฆู...');

            try {
                const response = await fetch('/api/customers');
                if (response.ok) {
                    const customers = await response.json();
                    console.log('ุชู ุชุญููู ุงูุฒุจุงุฆู:', customers.length);
                    displayCustomers(customers);
                } else {
                    throw new Error(`ุฎุทุฃ ูู ุงูุฎุงุฏู: ${response.status}`);
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุงูุฒุจุงุฆู:', error);
                showTableError(tableBody, 6, error.message, 'loadCustomers()');
            }

        }

        // ุนุฑุถ ุงูุฒุจุงุฆู
        function displayCustomers(customers) {
            const tableBody = document.getElementById('customersTableBody');
            if (!tableBody) return;

            if (!customers || customers.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">ูุง ุชูุฌุฏ ุฒุจุงุฆู</td></tr>';
                return;
            }

            let html = '';
            customers.forEach(customer => {
                html += `
                    <tr>
                        <td>${customer.phone_number}</td>
                        <td>${customer.name}</td>
                        <td>${customer.mobile_number || '-'}</td>
                        <td>${customer.company_name}</td>
                        <td>${customer.notes || '-'}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-info btn-sm" onclick="showCustomerDetailsAdmin(${customer.id})" title="ุนุฑุถ ุงูุชูุงุตูู ุงููุงููุฉ">
                                    <i class="fas fa-eye"></i> ุงูุชูุงุตูู
                                </button>
                                <button class="btn btn-outline-primary" onclick="editCustomer(${customer.id})" title="ุชุนุฏูู">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteCustomer(${customer.id})" title="ุญุฐู">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = html;
        }

        async function loadSiteSettingsAdmin() {
            try {
                const response = await fetch('/api/site-settings');
                if (response.ok) {
                    const settings = await response.json();
                    console.log('ุชู ุชุญููู ุงูุฅุนุฏุงุฏุงุช');
                } else {
                    throw new Error('ูุดู ูู ุชุญููู ุงูุฅุนุฏุงุฏุงุช');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุงูุฅุนุฏุงุฏุงุช:', error);
            }
        }

        async function loadBackups() {
            try {
                const response = await fetch('/api/backups');
                if (response.ok) {
                    const backups = await response.json();
                    console.log('ุชู ุชุญููู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ:', backups.length);
                } else {
                    throw new Error('ูุดู ูู ุชุญููู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ:', error);
            }
        }

        // ุชุญููู ุฅุญุตุงุฆูุงุช ุงูุฅุฏุงุฑุฉ
        async function loadAdminStats() {
            try {
                const response = await fetch('/api/admin-stats');
                if (response.ok) {
                    const stats = await response.json();
                    updateStatsDisplay(stats);
                } else {
                    throw new Error(`ุฎุทุฃ ูู ุงูุฎุงุฏู: ${response.status}`);
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุงูุฅุญุตุงุฆูุงุช:', error);
                // ุนุฑุถ ููู ุงูุชุฑุงุถูุฉ ูู ุญุงูุฉ ุงูุฎุทุฃ
                updateStatsDisplay({
                    users_count: 0,
                    successful: 0,
                    pending: 0,
                    rejected: 0
                });
            }
        }

        // ุชุญููู ุฅุนุฏุงุฏุงุช ุงููููุน ููุฅุฏุงุฑุฉ
        async function loadSiteSettingsAdmin() {
            try {
                const response = await fetch('/api/site-settings');
                if (response.ok) {
                    const settings = await response.json();
                    console.log('ุชู ุชุญููู ุฅุนุฏุงุฏุงุช ุงููููุน:', settings);

                    // ููุก ุงููููุฐุฌ ุจุงูุฅุนุฏุงุฏุงุช ุงููุญููุฉ
                    const siteNameField = document.getElementById('siteName');
                    const announcementField = document.getElementById('announcement');
                    const maintenanceModeField = document.getElementById('maintenanceMode');
                    const maintenanceReasonField = document.getElementById('maintenanceReason');

                    if (siteNameField) siteNameField.value = settings.site_name || 'ูุธุงู ุงูุชุณุฏูุฏ';
                    if (announcementField) announcementField.value = settings.announcement || 'ูุฑุญุจุงู ุจูู ูู ูุธุงู ุชุณุฏูุฏ ุงูููุงุชูุฑ';
                    if (maintenanceModeField) {
                        maintenanceModeField.value = settings.is_maintenance ? 'true' : 'false';
                        // ุชุญุฏูุซ ุนุฑุถ ูุณู ุณุจุจ ุงูุตูุงูุฉ
                        const reasonSection = document.getElementById('maintenanceReasonSection');
                        if (reasonSection) {
                            reasonSection.style.display = settings.is_maintenance ? 'block' : 'none';
                        }
                    }
                    if (maintenanceReasonField) maintenanceReasonField.value = settings.maintenance_reason || '';

                } else {
                    console.error('ุฎุทุฃ ูู ุชุญููู ุงูุฅุนุฏุงุฏุงุช:', response.status);
                    setDefaultSiteSettings();
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุฅุนุฏุงุฏุงุช ุงููููุน:', error);
                setDefaultSiteSettings();
            }
        }

        // ุชุญุฏูุฏ ุงูููู ุงูุงูุชุฑุงุถูุฉ ููุฅุนุฏุงุฏุงุช
        function setDefaultSiteSettings() {
            const siteNameField = document.getElementById('siteName');
            const announcementField = document.getElementById('announcement');
            const maintenanceModeField = document.getElementById('maintenanceMode');
            const maintenanceReasonField = document.getElementById('maintenanceReason');

            if (siteNameField) siteNameField.value = 'ูุธุงู ุงูุชุณุฏูุฏ';
            if (announcementField) announcementField.value = 'ูุฑุญุจุงู ุจูู ูู ูุธุงู ุชุณุฏูุฏ ุงูููุงุชูุฑ';
            if (maintenanceModeField) maintenanceModeField.value = 'false';
            if (maintenanceReasonField) maintenanceReasonField.value = '';

            const reasonSection = document.getElementById('maintenanceReasonSection');
            if (reasonSection) {
                reasonSection.style.display = 'none';
            }
        }

        // ุญูุธ ุฅุนุฏุงุฏุงุช ุงููููุน
        async function saveSiteSettings() {
            try {
                showLoadingOverlay('ุฌุงุฑู ุญูุธ ุงูุฅุนุฏุงุฏุงุช...');

                // ุฌูุน ุงูุจูุงูุงุช ูู ุงููููุฐุฌ
                const siteName = document.getElementById('siteName')?.value?.trim() || '';
                const announcement = document.getElementById('announcement')?.value?.trim() || '';
                const maintenanceMode = document.getElementById('maintenanceMode')?.value || 'false';
                const maintenanceReason = document.getElementById('maintenanceReason')?.value?.trim() || '';

                // ุงูุชุญูู ูู ุงูุจูุงูุงุช
                if (!siteName) {
                    showMessage('ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงููููุน', 'error');
                    return;
                }

                if (!announcement) {
                    showMessage('ูุฑุฌู ุฅุฏุฎุงู ูุต ุงูุฅุนูุงู', 'error');
                    return;
                }

                // ุฅุนุฏุงุฏ ุงูุจูุงูุงุช ููุฅุฑุณุงู
                const settingsData = {
                    site_name: siteName,
                    announcement: announcement,
                    is_maintenance: maintenanceMode === 'true',
                    maintenance_reason: maintenanceReason
                };

                console.log('ุฅุฑุณุงู ุงูุจูุงูุงุช:', settingsData);

                // ุฅุฑุณุงู ุงูุทูุจ
                const response = await fetch('/api/site-settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settingsData)
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(result.message || 'ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุจูุฌุงุญ', 'success');
                    console.log('ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุจูุฌุงุญ');
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุญูุธ ุงูุฅุนุฏุงุฏุงุช', 'error');
                    console.error('ุฎุทุฃ ูู ุญูุธ ุงูุฅุนุฏุงุฏุงุช:', result);
                }

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุญูุธ ุงูุฅุนุฏุงุฏุงุช:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            } finally {
                hideLoadingOverlay();
            }
        }

        // ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ
        async function createBackup() {
            try {
                showLoadingOverlay('ุฌุงุฑู ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ...');

                const response = await fetch('/api/create-backup', {
                    method: 'POST'
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(`ุชู ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ: ${result.filename}`, 'success');
                    loadBackups(); // ุฅุนุงุฏุฉ ุชุญููู ูุงุฆูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'error');
                }

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            } finally {
                hideLoadingOverlay();
            }
        }

        // ุชุญููู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
        async function loadBackups() {
            try {
                const response = await fetch('/api/backups');
                if (response.ok) {
                    const backups = await response.json();
                    console.log('ุชู ุชุญููู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ:', backups.length);
                    displayBackups(backups);
                } else {
                    console.error('ุฎุทุฃ ูู ุชุญููู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ:', response.status);
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ:', error);
            }
        }

        // ุนุฑุถ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
        function displayBackups(backups) {
            const tableBody = document.getElementById('backupsTableBody');
            if (!tableBody) return;

            if (!backups || backups.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center">ูุง ุชูุฌุฏ ูุณุฎ ุงุญุชูุงุทูุฉ</td></tr>';
                return;
            }

            let html = '';
            backups.forEach(backup => {
                const fileSize = backup.file_size ? (backup.file_size / 1024 / 1024).toFixed(2) + ' MB' : 'ุบูุฑ ูุญุฏุฏ';
                const createdAt = formatDate(backup.created_at);

                html += `
                    <tr>
                        <td>${backup.filename}</td>
                        <td>${fileSize}</td>
                        <td>${createdAt}</td>
                        <td>${backup.created_by || 'ุบูุฑ ูุญุฏุฏ'}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <a href="/api/download-backup/${backup.filename}" class="btn btn-outline-primary" title="ุชุญููู">
                                    <i class="fas fa-download"></i>
                                </a>
                                <button class="btn btn-outline-warning" onclick="showRestoreConfirm('${backup.filename}')" title="ุงุณุชุนุงุฏุฉ">
                                    <i class="fas fa-undo"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteBackup(${backup.id})" title="ุญุฐู">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = html;
        }

        // ุฅุธูุงุฑ ุชุฃููุฏ ุงูุงุณุชุนุงุฏุฉ
        function showRestoreConfirm(filename) {
            document.getElementById('restoreFilename').textContent = filename;
            document.getElementById('restoreBackupFilename').value = filename;

            const modal = new bootstrap.Modal(document.getElementById('restoreConfirmModal'));
            modal.show();
        }

        // ุชุฃููุฏ ุงูุงุณุชุนุงุฏุฉ
        async function confirmRestore() {
            const filename = document.getElementById('restoreBackupFilename').value;

            try {
                showLoadingOverlay('ุฌุงุฑู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ...');

                const response = await fetch(`/api/restore-backup/${filename}`, {
                    method: 'POST'
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(result.message || 'ุชู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ', 'success');

                    // ุฅุบูุงู ุงูููุฏุงู
                    const modal = bootstrap.Modal.getInstance(document.getElementById('restoreConfirmModal'));
                    if (modal) modal.hide();

                    // ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุจุนุฏ ูุชุฑุฉ ูุตูุฑุฉ
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'error');
                }

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            } finally {
                hideLoadingOverlay();
            }
        }

        // ุญุฐู ูุณุฎุฉ ุงุญุชูุงุทูุฉ
        async function deleteBackup(backupId) {
            if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉุ')) {
                return;
            }

            try {
                showLoadingOverlay('ุฌุงุฑู ุญุฐู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ...');

                const response = await fetch(`/api/backups/${backupId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage('ุชู ุญุฐู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ', 'success');
                    loadBackups(); // ุฅุนุงุฏุฉ ุชุญููู ุงููุงุฆูุฉ
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุญุฐู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'error');
                }

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุญุฐู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            } finally {
                hideLoadingOverlay();
            }
        }

        // ุฅุธูุงุฑ ููุฏุงู ุฑูุน ูุณุฎุฉ ุงุญุชูุงุทูุฉ
        function showUploadBackupModal() {
            const modal = new bootstrap.Modal(document.getElementById('uploadBackupModal'));
            modal.show();
        }

        // ุฑูุน ูุณุฎุฉ ุงุญุชูุงุทูุฉ
        async function uploadBackup() {
            const fileInput = document.getElementById('backupFileInput');
            const file = fileInput.files[0];

            if (!file) {
                showMessage('ูุฑุฌู ุงุฎุชูุงุฑ ููู ุฃููุงู', 'error');
                return;
            }

            if (!file.name.endsWith('.zip')) {
                showMessage('ูุฌุจ ุฃู ูููู ุงูููู ุจุตูุบุฉ ZIP', 'error');
                return;
            }

            try {
                const progressDiv = document.getElementById('uploadProgress');
                if (progressDiv) progressDiv.style.display = 'block';

                const formData = new FormData();
                formData.append('backup_file', file);

                const response = await fetch('/api/upload-backup', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage('ุชู ุฑูุน ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ', 'success');

                    // ุฅุบูุงู ุงูููุฏุงู
                    const modal = bootstrap.Modal.getInstance(document.getElementById('uploadBackupModal'));
                    if (modal) modal.hide();

                    // ูุณุญ ุงููููุฐุฌ ูุฅุนุงุฏุฉ ุชุญููู ุงููุงุฆูุฉ
                    document.getElementById('uploadBackupForm').reset();
                    loadBackups();
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุฑูุน ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'error');
                }

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฑูุน ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            } finally {
                const progressDiv = document.getElementById('uploadProgress');
                if (progressDiv) progressDiv.style.display = 'none';
            }
        }

        function showAddUserModal() {
            // ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ
            document.getElementById('userForm').reset();
            document.getElementById('userId').value = '';

            // ุชุนููู ุงูููู ุงูุงูุชุฑุงุถูุฉ
            document.getElementById('userBalance').value = '0';
            document.getElementById('userRole').value = 'user';
            document.getElementById('userStatus').value = '1';

            // ุฅุฎูุงุก ุงููุนูููุงุช ุงูุฅุถุงููุฉ
            const editInfo = document.getElementById('editUserInfo');
            if (editInfo) {
                editInfo.style.display = 'none';
            }

            // ุชุบููุฑ ุนููุงู ุงูููุฏุงู
            document.getElementById('userModalTitle').innerHTML = `
                <i class="fas fa-user-plus"></i> ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ
            `;

            // ุฅุธูุงุฑ ุงูููุฏุงู
            const modal = new bootstrap.Modal(document.getElementById('userModal'));
            modal.show();
        }

        function showAddCompanyModal() {
            document.getElementById('companyModalTitle').textContent = 'ุฅุถุงูุฉ ุดุฑูุฉ ุฌุฏูุฏุฉ';
            document.getElementById('companyForm').reset();
            document.getElementById('companyId').value = '';

            // ุชุญููู ุงููุฆุงุช ูู ุงููุงุฆูุฉ
            loadCategoriesForSelect();

            const modal = new bootstrap.Modal(document.getElementById('companyModal'));
            modal.show();
        }

        function showAddCustomerModal() {
            document.getElementById('customerModalTitle').textContent = 'ุฅุถุงูุฉ ุฒุจูู ุฌุฏูุฏ';
            document.getElementById('customerForm').reset();
            document.getElementById('customerId').value = '';

            // ุชุญููู ุงูุดุฑูุงุช ูู ุงููุงุฆูุฉ
            populateCustomerCompanySelect();

            const modal = new bootstrap.Modal(document.getElementById('customerModal'));
            modal.show();
        }

        // ุชุญููู ุงููุฆุงุช ูููุงุฆูุฉ
        async function loadCategoriesForSelect() {
            try {
                const response = await fetch('/api/categories');
                if (response.ok) {
                    const categories = await response.json();
                    const select = document.getElementById('companyCategory');
                    if (select) {
                        select.innerHTML = '<option value="">ุงุฎุชุฑ ุงููุฆุฉ</option>';
                        categories.forEach(category => {
                            const option = document.createElement('option');
                            option.value = category.id;
                            option.textContent = category.name;
                            select.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุงููุฆุงุช:', error);
            }
        }

        // ุชุญููู ุงูุดุฑูุงุช ููุงุฆูุฉ ุงูุฒุจุงุฆู
        async function populateCustomerCompanySelect() {
            try {
                const response = await fetch('/api/companies');
                if (response.ok) {
                    const companies = await response.json();
                    const select = document.getElementById('customerCompany');
                    if (select) {
                        select.innerHTML = '<option value="">ุงุฎุชุฑ ุงูุดุฑูุฉ</option>';
                        companies.forEach(company => {
                            const option = document.createElement('option');
                            option.value = company.id;
                            option.textContent = company.name;
                            select.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุงูุดุฑูุงุช:', error);
            }
        }

        // ุชุนุฏูู ุดุฑูุฉ
        async function editCompany(companyId) {
            try {
                const response = await fetch(`/api/companies/${companyId}`);
                if (response.ok) {
                    const company = await response.json();

                    // ููุก ุงููููุฐุฌ ุจุจูุงูุงุช ุงูุดุฑูุฉ
                    document.getElementById('companyId').value = company.id;
                    document.getElementById('companyName').value = company.name;
                    document.getElementById('companySubcategory').value = company.subcategory || '';
                    document.getElementById('companyCommission').value = company.commission || 0;
                    document.getElementById('companyStatus').value = company.is_active ? '1' : '0';

                    // ุชุญููู ุงููุฆุงุช ูุชุญุฏูุฏ ุงููุฆุฉ ุงูุญุงููุฉ
                    await loadCategoriesForSelect();
                    if (company.category_id) {
                        document.getElementById('companyCategory').value = company.category_id;
                    }

                    // ุชุบููุฑ ุนููุงู ุงูููุฏุงู
                    document.getElementById('companyModalTitle').textContent = 'ุชุนุฏูู ุงูุดุฑูุฉ';

                    // ุฅุธูุงุฑ ุงูููุฏุงู
                    const modal = new bootstrap.Modal(document.getElementById('companyModal'));
                    modal.show();
                } else {
                    showMessage('ุฎุทุฃ ูู ุชุญููู ุจูุงูุงุช ุงูุดุฑูุฉ', 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุจูุงูุงุช ุงูุดุฑูุฉ:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            }
        }

        // ุญุฐู ุดุฑูุฉ
        async function deleteCompany(companyId) {
            if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงูุดุฑูุฉุ')) {
                return;
            }

            try {
                const response = await fetch(`/api/companies/${companyId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage('ุชู ุญุฐู ุงูุดุฑูุฉ ุจูุฌุงุญ', 'success');
                    loadCompaniesAdmin(); // ุฅุนุงุฏุฉ ุชุญููู ูุงุฆูุฉ ุงูุดุฑูุงุช
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุญุฐู ุงูุดุฑูุฉ', 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุญุฐู ุงูุดุฑูุฉ:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            }
        }

        // ุชุนุฏูู ุฒุจูู
        async function editCustomer(customerId) {
            try {
                const response = await fetch(`/api/customers/${customerId}`);
                if (response.ok) {
                    const customer = await response.json();

                    // ููุก ุงููููุฐุฌ ุจุจูุงูุงุช ุงูุฒุจูู
                    document.getElementById('customerId').value = customer.id;
                    document.getElementById('customerPhone').value = customer.phone_number;
                    document.getElementById('customerName').value = customer.name;
                    document.getElementById('customerMobile').value = customer.mobile_number || '';
                    document.getElementById('customerNotes').value = customer.notes || '';

                    // ุชุญููู ุงูุดุฑูุงุช ูุชุญุฏูุฏ ุงูุดุฑูุฉ ุงูุญุงููุฉ
                    await populateCustomerCompanySelect();
                    if (customer.company_id) {
                        document.getElementById('customerCompany').value = customer.company_id;
                    }

                    // ุชุบููุฑ ุนููุงู ุงูููุฏุงู
                    document.getElementById('customerModalTitle').textContent = 'ุชุนุฏูู ุงูุฒุจูู';

                    // ุฅุธูุงุฑ ุงูููุฏุงู
                    const modal = new bootstrap.Modal(document.getElementById('customerModal'));
                    modal.show();
                } else {
                    showMessage('ุฎุทุฃ ูู ุชุญููู ุจูุงูุงุช ุงูุฒุจูู', 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุจูุงูุงุช ุงูุฒุจูู:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            }
        }

        // ุญุฐู ุฒุจูู
        async function deleteCustomer(customerId) {
            if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุฒุจููุ')) {
                return;
            }

            try {
                const response = await fetch(`/api/customers/${customerId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage('ุชู ุญุฐู ุงูุฒุจูู ุจูุฌุงุญ', 'success');
                    loadCustomers(); // ุฅุนุงุฏุฉ ุชุญููู ูุงุฆูุฉ ุงูุฒุจุงุฆู
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุญุฐู ุงูุฒุจูู', 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุญุฐู ุงูุฒุจูู:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            }
        }

        // ุญูุธ ุจูุงูุงุช ุงูุดุฑูุฉ
        async function saveCompany() {
            const companyId = document.getElementById('companyId').value;
            const name = document.getElementById('companyName').value.trim();
            const categoryId = document.getElementById('companyCategory').value;
            const subcategory = document.getElementById('companySubcategory').value.trim();
            const commission = parseFloat(document.getElementById('companyCommission').value) || 0;
            const isActive = document.getElementById('companyStatus').value === '1';

            if (!name || !categoryId) {
                showMessage('ุงุณู ุงูุดุฑูุฉ ูุงููุฆุฉ ูุทููุจุงู', 'error');
                return;
            }

            const data = {
                name: name,
                category_id: categoryId,
                subcategory: subcategory,
                commission: commission,
                is_active: isActive
            };

            try {
                const url = companyId ? `/api/companies/${companyId}` : '/api/companies';
                const method = companyId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(companyId ? 'ุชู ุชุญุฏูุซ ุงูุดุฑูุฉ ุจูุฌุงุญ' : 'ุชู ุฅุถุงูุฉ ุงูุดุฑูุฉ ุจูุฌุงุญ', 'success');
                    const modal = bootstrap.Modal.getInstance(document.getElementById('companyModal'));
                    if (modal) modal.hide();
                    loadCompaniesAdmin();
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุญูุธ ุงูุดุฑูุฉ', 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุญูุธ ุงูุดุฑูุฉ:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            }
        }

        // ุญูุธ ุจูุงูุงุช ุงูุฒุจูู
        async function saveCustomer() {
            const customerId = document.getElementById('customerId').value;
            const phoneNumber = document.getElementById('customerPhone').value.trim();
            const name = document.getElementById('customerName').value.trim();
            const mobileNumber = document.getElementById('customerMobile').value.trim();
            const companyId = document.getElementById('customerCompany').value;
            const notes = document.getElementById('customerNotes').value.trim();

            if (!phoneNumber || !name) {
                showMessage('ุฑูู ุงููุงุชู ูุงูุงุณู ูุทููุจุงู', 'error');
                return;
            }

            const data = {
                phone_number: phoneNumber,
                name: name,
                mobile_number: mobileNumber,
                company_id: companyId || null,
                notes: notes
            };

            try {
                const url = customerId ? `/api/customers/${customerId}` : '/api/customers';
                const method = customerId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(customerId ? 'ุชู ุชุญุฏูุซ ุงูุฒุจูู ุจูุฌุงุญ' : 'ุชู ุฅุถุงูุฉ ุงูุฒุจูู ุจูุฌุงุญ', 'success');
                    const modal = bootstrap.Modal.getInstance(document.getElementById('customerModal'));
                    if (modal) modal.hide();
                    loadCustomers();
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุญูุธ ุงูุฒุจูู', 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุญูุธ ุงูุฒุจูู:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            }
        }

        function showCategoriesModal() {
            console.log('ุฅุฏุงุฑุฉ ุงููุฆุงุช...');
        }

        // ุชุนุฏูู ูุณุชุฎุฏู - ูุญุณู ูุน ูุนูููุงุช ุฅุถุงููุฉ
        async function editUser(userId) {
            console.log('ุชุนุฏูู ุจูุงูุงุช ุงููุณุชุฎุฏู:', userId);

            if (!userId) {
                showMessage('ูุนุฑู ุงููุณุชุฎุฏู ุบูุฑ ุตุญูุญ', 'error');
                return;
            }

            try {
                showLoadingOverlay('ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงููุณุชุฎุฏู...');

                const response = await fetch(`/api/users/${userId}`);
                if (response.ok) {
                    const user = await response.json();
                    console.log('ุชู ุชุญููู ุจูุงูุงุช ุงููุณุชุฎุฏู:', user);

                    // ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงููููุฐุฌ
                    const userModal = document.getElementById('userModal');
                    const userForm = document.getElementById('userForm');

                    if (!userModal || !userForm) {
                        throw new Error('ูููุฐุฌ ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ');
                    }

                    // ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ ุฃููุงู
                    userForm.reset();

                    // ููุก ุงููููุฐุฌ ุจุจูุงูุงุช ุงููุณุชุฎุฏู
                    document.getElementById('userId').value = user.id;
                    document.getElementById('userName').value = user.name || '';
                    document.getElementById('userPhone').value = user.phone || '';
                    document.getElementById('userPassword').value = ''; // ุงุชุฑููุง ูุงุฑุบุฉ ููุฃูุงู
                    document.getElementById('userRole').value = user.role || 'user';
                    document.getElementById('userBalance').value = parseFloat(user.balance) || 0;
                    document.getElementById('userStatus').value = user.is_active ? '1' : '0';

                    // ุฅุธูุงุฑ ุงููุนูููุงุช ุงูุฅุถุงููุฉ ููุชุนุฏูู
                    const editInfo = document.getElementById('editUserInfo');
                    if (editInfo) {
                        editInfo.style.display = 'block';
                        const createdAtElement = document.getElementById('userCreatedAt');
                        const idDisplayElement = document.getElementById('userIdDisplay');

                        if (createdAtElement) {
                            createdAtElement.textContent = formatDate(user.created_at) || 'ุบูุฑ ูุญุฏุฏ';
                        }
                        if (idDisplayElement) {
                            idDisplayElement.textContent = user.id || 'ุบูุฑ ูุญุฏุฏ';
                        }
                    }

                    // ุชุบููุฑ ุนููุงู ุงูููุฏุงู
                    const modalTitle = document.getElementById('userModalTitle');
                    if (modalTitle) {
                        modalTitle.innerHTML = `
                            <i class="fas fa-user-edit text-primary"></i> ุชุนุฏูู ุจูุงูุงุช ุงููุณุชุฎุฏู: ${user.name}
                        `;
                    }

                    // ุฅุฎูุงุก Loading ุฃููุงู
                    hideLoadingOverlay();

                    // ุฅุธูุงุฑ ุงูููุฏุงู
                    const modal = new bootstrap.Modal(userModal, {
                        backdrop: 'static',
                        keyboard: false
                    });
                    modal.show();

                    // ุงูุชุฑููุฒ ุนูู ุญูู ุงูุงุณู
                    setTimeout(() => {
                        const nameField = document.getElementById('userName');
                        if (nameField) {
                            nameField.focus();
                        }
                    }, 500);

                    console.log('ุชู ูุชุญ ูููุฐุฌ ุงูุชุนุฏูู ุจูุฌุงุญ');
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    showMessage(errorData.error || `ุฎุทุฃ ูู ุชุญููู ุจูุงูุงุช ุงููุณุชุฎุฏู (${response.status})`, 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุจูุงูุงุช ุงููุณุชุฎุฏู:', error);
                if (error.name === 'AbortError') {
                    showMessage('ุงูุชูุช ูููุฉ ุงูุทูุจุ ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู', 'error');
                } else if (error.message.includes('Failed to fetch')) {
                    showMessage('ูุดู ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏูุ ุชุญูู ูู ุงูุงุชุตุงู', 'error');
                } else {
                    showMessage('ุฎุทุฃ ุบูุฑ ูุชููุน ูู ุชุญููู ุงูุจูุงูุงุช: ' + error.message, 'error');
                }
            } finally {
                hideLoadingOverlay();
            }
        }

        // ุญุฐู ูุณุชุฎุฏู
        async function deleteUser(userId) {
            if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงููุณุชุฎุฏูุ')) {
                return;
            }

            try {
                const response = await fetch(`/api/users/${userId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage('ุชู ุญุฐู ุงููุณุชุฎุฏู ุจูุฌุงุญ', 'success');
                    loadUsers(); // ุฅุนุงุฏุฉ ุชุญููู ูุงุฆูุฉ ุงููุณุชุฎุฏููู
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุญุฐู ุงููุณุชุฎุฏู', 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุญุฐู ุงููุณุชุฎุฏู:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            }
        }

        function manageUserBalance(id, name, balance) {
            // Populate the balance modal
            document.getElementById('balanceUserId').value = id;
            document.getElementById('balanceUserName').textContent = name;
            document.getElementById('currentBalance').textContent = balance;
            document.getElementById('balanceAmount').value = ''; // Clear previous amount
            document.getElementById('balanceNotes').value = '';   // Clear previous notes
            const modal = new bootstrap.Modal(document.getElementById('balanceModal'));
            modal.show();
        }

        // ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู
        async function saveUser() {
            const userId = document.getElementById('userId').value;
            const name = document.getElementById('userName').value.trim();
            const phone = document.getElementById('userPhone').value.trim();
            const password = document.getElementById('userPassword').value;
            const role = document.getElementById('userRole').value;
            const balance = parseFloat(document.getElementById('userBalance').value) || 0;
            const isActive = document.getElementById('userStatus').value === '1';

            if (!name || !phone) {
                showMessage('ุงูุงุณู ูุฑูู ุงูุฌูุงู ูุทููุจุงู', 'error');
                return;
            }

            const data = {
                name: name,
                phone: phone,
                role: role,
                balance: balance,
                is_active: isActive
            };

            if (password) {
                data.password = password;
            }

            try {
                const url = userId ? `/api/users/${userId}` : '/api/users';
                const method = userId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(userId ? 'ุชู ุชุญุฏูุซ ุงููุณุชุฎุฏู ุจูุฌุงุญ' : 'ุชู ุฅุถุงูุฉ ุงููุณุชุฎุฏู ุจูุฌุงุญ', 'success');
                    const modal = bootstrap.Modal.getInstance(document.getElementById('userModal'));
                    if (modal) modal.hide();
                    loadUsers();
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุญูุธ ุงููุณุชุฎุฏู', 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุญูุธ ุงููุณุชุฎุฏู:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            }
        }

        async function sendUserNotification(id, name) {
            document.getElementById('notificationUserId').value = id;
            document.getElementById('notificationUserName').textContent = name;
            document.getElementById('notificationTitle').value = '';
            document.getElementById('notificationMessage').value = '';

            const modal = new bootstrap.Modal(document.getElementById('notificationModal'));
            modal.show();
        }

        

        function saveCategory() {
            console.log('ุญูุธ ุงููุฆุฉ...');
        }

        async function addBalance() {
             const userId = document.getElementById('balanceUserId').value;
            const amount = parseFloat(document.getElementById('balanceAmount').value);
            const notes = document.getElementById('balanceNotes').value;

            if (!userId || !amount) {
                showMessage('ุงููุจูุบ ูุทููุจ', 'error');
                return;
            }

            const data = {
                amount: amount,
                notes: notes
            };

            try {
                const response = await fetch(`/api/users/${userId}/add-balance`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage('ุชู ุฅุถุงูุฉ ุงูุฑุตูุฏ ุจูุฌุงุญ', 'success');
                    const modal = bootstrap.Modal.getInstance(document.getElementById('balanceModal'));
                    if (modal) modal.hide();
                    loadUsers();
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูุฑุตูุฏ', 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูุฑุตูุฏ:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            }
        }

        async function deductBalance() {
            const userId = document.getElementById('balanceUserId').value;
            const amount = parseFloat(document.getElementById('balanceAmount').value);
            const notes = document.getElementById('balanceNotes').value;

            if (!userId || !amount) {
                showMessage('ุงููุจูุบ ูุทููุจ', 'error');
                return;
            }

            const data = {
                amount: amount,
                notes: notes
            };

            try {
                const response = await fetch(`/api/users/${userId}/deduct-balance`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage('ุชู ุฎุตู ุงูุฑุตูุฏ ุจูุฌุงุญ', 'success');
                    const modal = bootstrap.Modal.getInstance(document.getElementById('balanceModal'));
                    if (modal) modal.hide();
                    loadUsers();
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุฎุตู ุงูุฑุตูุฏ', 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฎุตู ุงูุฑุตูุฏ:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            }
        }

        async function sendNotification() {
            const userId = document.getElementById('notificationUserId').value;
            const title = document.getElementById('notificationTitle').value;
            const message = document.getElementById('notificationMessage').value;

            if (!userId || !title || !message) {
                showMessage('ุงูุนููุงู ูุงูุฑุณุงูุฉ ูุทููุจุฉ', 'error');
                return;
            }

            const data = {
                title: title,
                message: message
            };

            try {
                const response = await fetch(`/api/users/${userId}/send-notification`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage('ุชู ุฅุฑุณุงู ุงูุฅุดุนุงุฑ ุจูุฌุงุญ', 'success');
                    const modal = bootstrap.Modal.getInstance(document.getElementById('notificationModal'));
                    if (modal) modal.hide();
                } else {
                    showMessage(result.error || 'ุฎุทุฃ ูู ุฅุฑุณุงู ุงูุฅุดุนุงุฑ', 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅุฑุณุงู ุงูุฅุดุนุงุฑ:', error);
                showMessage('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            }
        }

        function showAddCategoryModal() {
            console.log('ุนุฑุถ ุฅุถุงูุฉ ูุฆุฉ...');
        }

        // ุฏุงูุฉ ุฅุธูุงุฑ/ุฅุฎูุงุก ูููุฉ ุงููุฑูุฑ
        function togglePasswordVisibility(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');

            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // ุงูุชุฃูุฏ ูู ุชููุฑ ุฌููุน ุงูุฏูุงู ุนุงูููุงู
        window.showAdminSection = showAdminSection;
        window.refreshStats = refreshStats;
        window.refreshPaymentRequests = refreshPaymentRequests;
        window.searchPaymentRequests = searchPaymentRequests;
        window.clearSearchFilters = clearSearchFilters;
        window.showRequestDetails = showRequestDetails;
        window.handleRequestAction = handleRequestAction;
        window.loadCompaniesAdmin = loadCompaniesAdmin;
        window.loadCustomers = loadCustomers;
        window.loadSiteSettingsAdmin = loadSiteSettingsAdmin;
        window.loadBackups = loadBackups;
        window.showAddUserModal = showAddUserModal;
        window.showAddCompanyModal = showAddCompanyModal;
        window.showAddCustomerModal = showAddCustomerModal;
        window.showCategoriesModal = showCategoriesModal;
        window.editUser = editUser;
        window.deleteUser = deleteUser;
        window.editCompany = editCompany;
        window.deleteCompany = deleteCompany;
        window.editCustomer = editCustomer;
        window.deleteCustomer = deleteCustomer;
        window.saveCompany = saveCompany;
        window.saveCustomer = saveCustomer;
        window.manageUserBalance = manageUserBalance;
        window.saveUser = saveUser;
        window.saveSiteSettings = saveSiteSettings;
        window.createBackup = createBackup;
        window.saveCategory = saveCategory;
        window.addBalance = addBalance;
        window.deductBalance = deductBalance;
        window.sendNotification = sendNotification;
        window.showAddCategoryModal = showAddCategoryModal;
        window.sendUserNotification = sendUserNotification;
        window.displayUsers = displayUsers;
        window.loadUsers = loadUsers;

        console.log('ุชู ุชุตุฏูุฑ ุฌููุน ุงูุฏูุงู ุงูุฅุฏุงุฑูุฉ ุจูุฌุงุญุ ุจูุง ูู ุฐูู editUser');
    </script>
</body>
</html>